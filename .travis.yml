sudo: required

cache: bundler

language: ruby

rvm:
  - 2.3.1

env:
  DOCKER_COMPOSE_VERSION: 1.8.1

services:
  - docker

before_install:
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin

install:
  - docker-compose build
  - docker-compose up -d rabbit
  - sleep 30
  - docker-compose logs rabbit
  - docker-compose up -d janus
  - sleep 30
  - docker-compose logs janus

script:
  - docker-compose run gem bundle exec rake

deploy:
  provider: rubygems
  gemspec: rrj.gemspec
  gem: ruby_rabbitmq_janus
  on:
    branch: master
    repo: dazzl-tv/ruby-rabbitmq-janus
  skip_cleanup: true
  user: jeremy.vaillant@dazzl.tv
  api_key:
    secure: gIQXc5+Pcnb3YCOiDScxnRgXRmYQ/nqjoApYLGlBV9US3IpiHO1wNP9y/6fvjwJuZ/+CfR5d1hdotBjHRfrQP4UHUYfFFb3Ut3L7YMPTCSofv868aVSInocuivCxpK2Hwa54udoqbjsDc7NpDLhTd8ztFVouMdbXoF1cOCMKr3pboPvlcouI52eOC5qK6XVGwzO1iGPaacvFdUbXDD/EeAWZru7wd1QYozfhATQu1UgDpbyUEeLQ8cXdnhPx/AsBG9qRSjaUdOsEmla21DaIGwFoqFkMctceZ0Rpo+GIGF0+ejiRn42+Rm/hA6uJnGqMxzwJmZo7XOayCTAGCnsLQ3SAKTb6c8+OX2waJmcLW2L14PQlElKFrUVBGZlZwz1AK3LN7M28rLAJlVO+KUhTn09msy8tr5U/v7pcHYQcfoO/eTj6n13UOKzRaqY8ST+d+rAunp/DXAprqv/IzJzZDISmsh00JtWJLQwWlYw51ej5wqB5MEQ0qD5uGbVFKsyW7g5zazVkrbQc4uRihyHY38Isrl1ylPcVqf5XDMvbdFwQ2nE/DirxsB57BkCx1mxuruu+Tdzw2koMa00AAMm5irXcOxUKQxdFKMLd2WwyzUZWl05iBb5vNICAqdqmtrprPhLhT8iiM/LxL20KkU6T+yJmqmbzP0Ykt3iF0n+RE8k=

notifications:
  email: false
  slack:
    on_success: always
    rooms:
      secure: JXIY11k83SPItgfkS1l81DBZHY70MnBbRkrYquc5vfoGZdL6IqVNroScVPTB0XT1VxPuAZCOj6eB3qEUNofGeUKXrxW3ByKZZDA6JGq/s0DxGRmueQ4H21QKES+ljc2p6oCnlH5hMRuKvgzhIVtOX+/IuTU9u1/LBAjfK+U5Fz3gbWwDDJMYeB1BUZ+iLV+hwKX5kxlEbEE6VNaZereNItmtH2RenarhWW/hVFneOUPG5ul5IBxUDVa6DRQUfTbpusrbgTwWoMFO6n2y2+suDCn1nUyZDM5qst/T6MJ/82nTPDOdp0iYmCAkSgW+oSRu/vMnfbgZ5Q7H+Re96zkzh66BCNGCvFw0KbZhOyD5KpVYe/a9+OBXv/MlUOTMoQNWQs1dJDfkfis9eKT1LqSD5vwEYv1rJG34CWCvttwxeqQHZNru9+eMclyK5voo1X4Ho0C7f9m3gaPelPdOQL/tZCMIm/Yrgxmzv2kO9Ruho8l9IfwVWuWEnxDbZ+gwRwZ3ItX45AwIWL4bqiqc3cBz+pB5hqNIWNlR5gMzFBsWMZxD0KWKeQME2nopfglybCmUjWyPWm2iZ/6IOqvsLKCmInP0y0QMBjp7LPfXHsYD8x4RcssSes3oorM22DcG8s0DiUmvJGkSRYzib46M2hWFKu/uNP+3cmJk908WdQT1BHY=
