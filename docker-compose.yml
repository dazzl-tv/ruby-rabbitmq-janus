version: '3'

services:
  gem:
    build:
      context: .
      dockerfile: Dockerfile
    links:
      - rabbit
      - mongo
    volumes:
      - ./lib/rrj/:/ruby_rabbitmq_janus/lib/rrj
      - ./spec/:/ruby_rabbitmq_janus/spec
      - ./tmp/:/ruby_rabbitmq_janus/tmp

  rabbit:
    image: rabbitmq:alpine

  janus:
    image: canyan/janus-gateway:latest
    links:
      - rabbit
    container_name: janus

  janus_token:
    image: canyan/janus-gateway:latest
    links:
      - rabbit
    container_name: janus_token
    volumes:
      - ./.github/janus.jcfg:/usr/local/etc/janus/janus.jcfg
      - ./.github/janus.transport.rabbitmq.jcfg:/usr/local/etc/janus/janus.transport.rabbitmq.jcfg

  mongo:
    image: mongo
    ports:
      - 5555:27017
