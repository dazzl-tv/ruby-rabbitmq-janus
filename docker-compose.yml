version: '3'

services:
  gem:
    build:
      context: .
      dockerfile: Dockerfile
    links:
      - rabbit
      - mongo
    volumes:
      - ./lib/rrj/:/ruby_rabbitmq_janus/lib/rrj
      - ./spec/:/ruby_rabbitmq_janus/spec
      - ./coverage/:/ruby_rabbitmq_janus/coverage

  rabbit:
    image: rabbitmq:alpine
    ports:
      - 5672
      - 15672:15672

  janus:
    build:
      context: .travis
      dockerfile: janus.1.dockerfile
    links:
      - rabbit
    container_name: janus

  janus_token:
    build:
      context: .travis
      dockerfile: janus.2.dockerfile
    links:
      - rabbit
    container_name: janus_token

  mongo:
    image: mongo
    ports:
      - 5555:27017
